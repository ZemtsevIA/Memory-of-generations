if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
}

document.addEventListener('DOMContentLoaded', function () {
    // Прокрутка к началу страницы
    window.scrollTo(0, 0);

    // Функция для проверки, находится ли элемент в области просмотра
    function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)
        );
    }

    // Анимация для элементов
    const elements = document.querySelectorAll('.header, .veteran, .veteran h1, .veteran p, .cards-container, .card, .footer');
    
    // Проверяем элементы при загрузке страницы
    elements.forEach((element) => {
        if (isElementInViewport(element)) {
            element.classList.add('visible');
        }
    });

    // Настройка IntersectionObserver
    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target); // Отключаем наблюдение после срабатывания
                }
            });
        },
        {
            threshold: 0.2, // Увеличиваем порог до 20%
            rootMargin: '50px' // Добавляем отступ, чтобы анимация срабатывала раньше
        }
    );

    // Наблюдаем за каждым элементом, если он ещё не видим
    elements.forEach((element) => {
        if (!element.classList.contains('visible')) {
            observer.observe(element);
        }
    });

    // Принудительное отображение верхних элементов
    const topElements = document.querySelectorAll('.header, .veteran h1, .veteran p');
    topElements.forEach((element) => {
        element.classList.add('visible');
    });

    // Обработчик клика по карточкам ветеранов
    document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', function() {
            const modal = document.querySelector('.veteran-modal-overlay');
            const cardId = this.dataset.cardId;
            const cardData = veteransDatabase[cardId];

            // Заполняем модальное окно
            modal.querySelector('.modal-image').src = this.querySelector('img').src;
            modal.querySelector('.modal-title').innerText = this.querySelector('h3').innerText;
            modal.querySelector('.modal-subtitle').innerText = this.querySelector('h4').innerText;
            const modalContent = modal.querySelector('.modal-content');
            if (cardData && cardData.description) {
                modalContent.innerHTML = `
                    <p><strong>Год рождения:</strong> ${cardData.birthYear}</p>
                    <p><strong>Награды:</strong> ${cardData.awards.join(', ')}</p>
                    <p><strong>Биография:</strong> ${cardData.description}</p>
                `;
            } else {
                modalContent.innerHTML = '<p>Информация отсутствует</p>';
            }

            // Показываем модальное окно
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });
    });

    // Закрытие модального окна
    document.querySelector('.veteran-modal-overlay').addEventListener('click', function(e) {
        if (e.target.classList.contains('veteran-modal-overlay') || e.target.classList.contains('close')) {
            this.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });

    // Закрытие модального окна по клавише ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modal = document.querySelector('.veteran-modal-overlay');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });
});

// База данных ветеранов
const veteransDatabase = {
    1: {
        birthYear: "1919",
        awards: ["Орден Красной Звезды"],
        description: "Овсянников Всеволод Петрович участвовал в Великой Отечественной войне, проявил мужество в боях. После войны работал в ТУСУРе, внёс значительный вклад в развитие университета."
    },
    2: {
        birthYear: "1917",
        awards: ["Орден Красной Звезды"],
        description: "Суслов Иннокентий Алексеевич — кандидат технических наук, доцент. Участник Великой Отечественной войны, награждён Орденом Красной Звезды. Автор свыше 120 научных статей. В ТУСУРе работал с его основания. Один из первых педагогов РТФ, отдавший много сил и стараний становлению и развитию подготовки радиоинженеров в Томске. Организатор и руководитель работ по разработке и исследованию широкополосных и импульсных усилителей. Активный деятель радиотехнического общества им. А.С. Попова, член общественной редакции издательства «Радио»."
    },
    3: {
        birthYear: "1918",
        awards: ["Орден Красной Звезды"],
        description: "Юргин Константин Иванович — кандидат педагогических наук. Участник Великой Отечественной войны, награждён высокими правительственными наградами, в том числе Орденом Красной Звезды. В ТУСУРе работал с его основания. Сначала старшим преподавателем английского языка, а с 1979 года — заведующим этой кафедры. Константин Иванович принимал самое активное участие в общественной жизни университета. Он неоднократно избирался секретарём партбюро факультета, много лет работал заместителем секретаря партбюро и председателем Совета ветеранов института."
    },
    4: {
        birthYear: "1918",
        awards: ["Орден Отечественной войны II степени", "Орден Красной Звезды", "Медаль «За отвагу»", "Медаль «За оборону Сталинграда»", "Медаль «За оборону Москвы»"],
        description: "Саворовский Игорь Андреевич — участник боёв на Халхин-Голе, войны с белофиннами и Великой Отечественной войны. Общий трудовой стаж более 45 лет. Активный член Совета ветеранов института. В ТУСУРе работал с его основания квалифицированным рабочим кафедры физики. Основные достижения: значительный вклад в оснащение учебного процесса, оборудование лабораторий кафедры. Имеет 12 правительственных наград."
    },
    5: {
        birthYear: "1924",
        awards: ["Медаль «За победу над Германией в Великой Отечественной войне 1941-1945 гг.»", "Медаль «30 лет Победы в Великой Отечественной войне 1941-1945 гг.»", "Медаль «Ветеран труда»"],
        description: "Носков Дмитрий Александрович — заведующий кафедрой электронных приборов, профессор, доктор технических наук. Один из наиболее плодовитых изобретателей университета. Участник Великой Отечественной войны. В ТУСУРе работал с его основания. Основные достижения: постоянная научно-исследовательская работа, автор многочисленных научных статей и изобретений. Имеет несколько наград, в том числе медали «За победу над Германией в Великой Отечественной войне 1941-1945 гг.», «30 лет Победы в Великой Отечественной войне 1941-1945 гг.» и «Ветеран труда»."
    },
    6: {
        birthYear: "1914",
        awards: ["Медаль «За оборону Ленинграда»", "Медаль «За боевые заслуги»", "Медаль «За отвагу»", "Орден Отечественной войны I степени"],
        description: "Янковский Пётр Романович стал свидетелем встречи с американскими войсками на Эльбе. Был в окружении под Новгородом, участвовал в освобождении от фашистских захватчиков Латвии, Литвы, Польши, Восточной Пруссии. За заслуги в Великой Отечественной войне и трудовую доблесть награждён 12 медалями, в том числе медали «За оборону Ленинграда», «За боевые заслуги», «За отвагу», орден Отечественной войны I степени. 22 года проработал в ТИАСуре с 1964 года. Будучи столяром экспериментальных мастерских 6 разряда, своим квалифицированным добросовестным трудом внёс существенный вклад в оснащение учебно-научных лабораторий и эстетическое оформление помещений университета."
    },
    7: {
        birthYear: "1912",
        awards: ["Орден Отечественной войны II степени"],
        description: "Бакшт Хаим Самуилович участвовал в боях на Ленинградском фронте. Ему было доверено командование первой в истории войны передвижной радиолокационной станцией. Имеет 16 правительственных наград. Автор 15 научных работ и многих учебно-методических пособий. В ТУСУРе занимался научными исследованиями в области электроники."
    },
    8: {
        birthYear: "1911",
        awards: ["Медаль «За оборону Ленинграда»"],
        description: "Силов Евгений Николаевич воевал на Ленинградском фронте, участвовал в блокаде Ленинграда. Имеет множество наград. Создал первый любительский телецентр в Сибири. В ТУСУРе работал с самого его основания, внёс вклад в образовательные программы."
    },
    9: {
        birthYear: "1908",
        awards: ["Ряд правительственных наград"],
        description: "Кузнецов Филолог Нилович — доцент кафедр общественных наук. Участник Великой Отечественной войны. За участие в Великой Отечественной войне и добросовестный труд награждён рядом правительственных наград. В ТУСУРе работал с его основания. Принимал активное участие в общественной жизни института. Неоднократно избирался членом партбюро института, был активным членом общества «Знание» — добровольной общественной научно-просветительской организации."
    },
    10: {
        birthYear: "1920",
        awards: ["Орден Красной Звезды"],
        description: "Чечулин Павел Иванович — старший преподаватель кафедры электронных приборов. Участник Великой Отечественной войны, награждён Орденом Красной Звезды и тремя медалями. В первые годы работы института исполнял обязанности начальника учебного отдела, много лет работал деканом факультета вечернего обучения. Вёл большую работу по обучению студентов и сотрудников института технике безопасности, противопожарной технике и охране труда."
    },
    11: {
        birthYear: "1919",
        awards: ["Ряд правительственных наград"],
        description: "Сонин Борис Михайлович — заведующий фотолабораторией. Участник Великой Отечественной войны. В ТУСУРе работает с его основания. Деятельность фотолаборатории под руководством Бориса Михайловича Сонина способствовала: изданию множества научных работ, созданию учебных и учебно-методических пособий, разработке технических средств обучения, художественному оформлению вестибюлей, аудиторий, лабораторий и других помещений института."
    },
    12: {
        birthYear: "1922",
        awards: ["Ряд правительственных наград"],
        description: "Павлова Мария Михайловна — старший препаратор кафедры телевизионных устройств, активный член Совета Ветеранов ТУСУРа. Участник Великой Отечественной войны. За боевые заслуги и добросовестный труд награждена 8 медалями. Марию Михайловну отличает: исключительно добросовестное отношение к служебным обязанностям, инициативность, активное участие в общественной жизни университета."
    },
    13: {
        birthYear: "1918",
        awards: ["Ряд правительственных наград"],
        description: "Борисов Василий Иванович — старший преподаватель кафедры телевизионных устройств. Участник Великой Отечественной войны. В ТУСУРе работал с его основания. Участвовал в разработке и создании первого в Сибири томского телецентра. Василий Иванович был: высококвалифицированным педагогом, строгим, но справедливым преподавателем, пользовавшимся высоким авторитетом у студентов, активным участником научно-исследовательских работ кафедры."
    }
};

// Cloudflare скрипт
(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9385d33feb164535',t:'MTc0NjAwMzM3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();